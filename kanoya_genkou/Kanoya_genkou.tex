%%
%% 研究報告用スイッチ
%% [techrep]
%%
%% 欧文表記無しのスイッチ(etitle,eabstractは任意)
%% [noauthor]
%%

%\documentclass[submit,techrep]{ipsj}
\documentclass[submit,techrep,noauthor]{ipsj}



%\usepackage[dvips]{graphicx}
\usepackage[dvipdfmx]{graphicx}
\usepackage{latexsym}
\usepackage{url}

\def\newblock{\hskip .11em plus .33em minus .07em}

\def\Underline{\setbox0\hbox\bgroup\let\\\endUnderline}
\def\endUnderline{\vphantom{y}\egroup\smash{\underline{\box0}}\\}
\def\|{\verb|}
%

%\setcounter{巻数}{59}%vol59=2018
%\setcounter{号数}{10}
%\setcounter{page}{1}

\newcommand{\saitohcom}[1]{\textbf{{\color{blue}{[saitoh comments: #1]}}}}


\begin{document}


\title{数独に対する最も簡単な解法探索による難易度判定付き\\ソルバー}
%（2023年7月14日版）}

\etitle{Sudoku solver with difficulty rating by simplest solution search}%\\ (version 2023/7/14)}

%\affiliate{IPSJ}{情報処理学会\\
%IPSJ, Chiyoda, Tokyo 101--0062, Japan}

\paffiliate{KIT}{九州工業大学\\
Kyusyu Institute University}

\author{鹿屋 直大}{Naohiro Kanoya}{KIT}[kanoya．naohiro706@mail．kyutech．jp]
\author{斎藤 寿樹}{Toshiki Saitoh}{KIT}

\begin{abstract}
近年，パズルを自作し，作成したその問題を発表できるサイトの公開などにより，パズルを作成時に自分でその難易度を判断する場面が増えてきた．難易度の判定には，1つのパズルにある様々な解法の中で最も簡単なものを探す必要がある．しかし，人間が難易度の判定を行うと，可能な限り全ての解法を考えるため，同じ問題を何度も解き直す必要があり，多くの時間がかかってしまい，また見落としにより正確さも保障できない．よって，パズルの問題を入力として与えると目安となる難易度が確認できるソルバーがあるとパズル作家にとって，非常に便利である．本研究では，数独の問題を与えると，解の一意性を判定でき，一番簡単な解法を選んだ場合に難易度の目安となる点数を計算するアルゴリズムを作成した．また，本提案手法により得られた難易度は本に掲載されている難易度と強い相関を持つことを示す．
\end{abstract}


%
%\begin{jkeyword}
%情報処理学会論文誌ジャーナル，\LaTeX，スタイルファイル，べからず集
%\end{jkeyword}
%
%\begin{eabstract}
%This document is a guide to prepare a draft for submitting to IPSJ
%Journal, and the final camera-ready manuscript of a paper to appear in
%IPSJ Journal, using {\LaTeX} and special style files．  Since this
%document itself is produced with the style files, it will help you to
%refer its source file which is distributed with the style files．
%\end{eabstract}
%
%\begin{ekeyword}
%IPSJ Journal, \LaTeX, style files, ``Dos and Dont's'' list
%\end{ekeyword}


\maketitle

%1
\section{はじめに}
多くのパズルは解が一意であることが重要とされる．パズルの作り手は自作の問題を作成した時に，その解の一意性を確認する必要がある．それに加え，近年では自作の問題を発表できるサイトの公開などにより，パズルの作成時に自分でその難易度を判断する場面が増えてきた\cite{PuzzleSq83:online}.しかしこれらを人間が手作業で行う場合，自分で作成した問題をもう一度自分で解き直さなければならないため，時間がかかる.特に難易度の判定に時間がかかる.多くのパズルは，パズルを解くためのテクニックである「手筋」を使う順番の違いなどによって解法が様々にある.そのようなパズルの難易度を判定する場合，その解法の中で一番簡単なものを見つけ，その解法から難易度を決定することが望まれる時がある.しかしそれを人間が行うには全ての解法に対して同じ問題を解いて難易度を確認しなければならない.それにはかなり時間がかかり，また人の手で行っているため正確に行うのも難しい.よって，問題を入力として与えると，一意性の確認と難易度の目安の出力ができるソルバーがあると便利である.先行研究において土手氏らによる手筋を見つけるのに探索したブロック、行または列（以下、これら3つをまとめて領域と呼ぶ）の数により数独の難易度を数値化するような研究があった\cite{土出智也2011数独パズルの難易度判定}.しかしこの手法は探索で手筋を見つけるとすぐに盤面にその手筋を適用しており，多数ある解法の中で一番簡単なものを特定していないため、解いている人がその簡単な解法で解いた場合、その人が感じる難易度と異なる可能性がある.よって本研究では，数独の問題を与えると，解の一意性を判定でき，一番簡単な解法を探索してその解法に対する難易度の目安となる点数を計算するアルゴリズムを作成する.この手法では、解答途中の盤面を局面とした分枝探索法によって最も簡単な解法を探索する。最も簡単な解法を見つけることで、見つけたところから手筋を適用するような手法にはない観点から難易度の決定を行う事ができる。また市販の単行本に対して、土出氏らの先行研究と本研究のどちらが実際に問題に付けられている難易度と強い相関があるかを調べた。その結果、本研究の方が強い相関があったので、そのことを示し本研究が有用であることを示す。


%2
\section{数独と数独を解く手筋}

\subsection{数独}

数独とは，株式会社ニコリのペンシルパズルである．同じルールではあるが，別の名前で別の会社がこのパズルを取り扱うこともある．数独のルールは以下の通りである\cite{sudoku58:online}．
	\begin{itemize}
	\item あいているマスに，1から9までの数字のどれかを入れる．
	\item タテ列 (9列ある)， ヨコ列 (9列ある)， 太線で囲まれた3×3のブロック (それぞれ9マスあるブロックが9つある) のどれにも1から9までの数字が1つずつ入る．
	\end{itemize}
\figref{sample_sudoku} と~\ref{sample_sudoku_answer} に数独の例およびその答えをそれぞれ示す．
\saitohcom{用語として「空きマス」を要定義？}

	\begin{figure}[tb]
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.25]
      		{sample_sudoku.png}
 	\caption{数独の例}
	% \ecaption{Example of sudoku}
 	\label{sample_sudoku}
	\end{minipage}%
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.25]
      		{sample_sudoku_answer.png}
 	\caption{\figurename~\ref{sample_sudoku} の答え}
	% \ecaption{Example of sudoku - Answer}
 	\label{sample_sudoku_answer}
	\end{minipage}
  	\end{figure}
%%http://pzv．jp/p．html?sudoku_edit/9/9/i1i9h234j7g567g3h4g8j72k9k49j1g8h6g234g2j567h1i8i

\subsection{数独の手筋}

数独にはパズルを解く上で便利な手筋が知られている．
ここでは，本稿で特に重要視する一部の手筋について説明する．
以下，1から9までの数字が1つずつ入る領域（ブロック，行，列）を\emph{領域}と呼ぶこととする．

	\subsubsection{レッツミー}
行もしくは列内において，ある数字の入る場所が1つしかない時にその場所にその数字を入れるという手筋を\emph{レッツミー}と呼ぶ．これは中級手筋として知られている~\cite{数独通信43}．\figref{sample_rettumi}の盤面の場合，一番上の行における1の位置が\figref{sample_r_a}のように決定する．

	\begin{figure}[tb]
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.25]
      		{sample_rettumi.png}
 	\caption{レッツミーの例}
 	\label{sample_rettumi}
	%\ecaption{Example of rettumi}
	\end{minipage}%
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.25]
      		{sample_rettumi_answer.png}
 	\caption{レッツミーの例:入れた後}
	 %\ecaption{Example of rettumi: after filling}
 	\label{sample_r_a}
	\end{minipage}
  	\end{figure}

	\subsubsection{マスミ}
あるマスにおいて，8種類の数字が同じ場所にあるため，その8種類の数字にない1つの数字をそのマスに埋める手筋を\emph{マスミ}と呼ぶ．これは中級手筋がとして知られている\cite{数独通信43}．\figref{sample_masumi}の盤面の場合，一番左上のマスが\figref{sample_masumi_answer}のように9に決定する．

	\begin{figure}[tb]
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.25]
      		{sample_masumi.png}
 	\caption{マスミの例}
 	\label{sample_masumi}
	 %\ecaption{Example of masumi}
	\end{minipage}%
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.25]
      		{sample_masumi_answer.png}
 	\caption{マスミの例:埋めた後}
 	\label{sample_masumi_answer}
	 %\ecaption{Example of masumi: after filling}
	\end{minipage}
  	\end{figure}

\subsubsection{表予約}
1から9のうち2つの数字に対して、ある領域でそれらの数字が入る可能性のあるマスが、同じ2マスで重複しているときを考える。この時、その2マスにその2つの数字以外の数字は入らない。例えば\figref{yoyaku_sample}では，左上のブロックにおいて，三角で表した2つのマスは1 または 2しか入らない．これらの三角で示したマスに1，2以外の数字が入ると，三角のマス以外に 1または2を入れることになるが，それらの行もしくは列には 1 や 2 が存在してしまい，1 や 2 を入れることができない．よって，三角で示したマスに1と2以外の数字は入らない．この手筋を一般に予約と呼ぶが，ここでは次に説明する手筋と区別するために\emph{表予約}と呼ぶ\cite{数独通信43}．また、表予約は2つの数字に対するある領域の2マスだけでなく、数字とマスがそれぞれ3つから7つの場合でも成立する。

	\begin{figure}[tb]
	 \centering
 	\includegraphics[keepaspectratio, scale=0.2]
      		{sample_yoyaku_blo2.png}
 	\caption{表予約の例}
	 %\ecaption{Example of front reservation}
 	\label{yoyaku_sample}
	\end{figure}

%3
\section{提案手法}

\subsection{問題の難易度点数}
本研究では数独の問題が与えられると，一番簡単な解法を探し，その解法の難易度点数を決定する手法を提案する．ここでは解法を使用した手筋の列で表すとする．各手筋には，次節で示しす正の点数が付けられており，解法で用いた各手筋の点数を合計した値をその\emph{解法の点数}とする．解法の点数が高ければ高いほど，難易度は高いと考える．本研究ではすべての解法の中から最も点数の小さい解法の点数を，その\emph{問題の難易度点数}と定義する．

\subsection{各手筋の難易度点数の決定方法}
\saitohcom{各手筋をどのように点数化するのかを述べる．具体的にどのような点になったのか，ではなく，点数化する手法もしくはその根拠等を述べる．}パズルを解くときに感じる難易度には個人差がある。ここで参考にする難易度として、近年の株式会社ニコリで出版されている数独を参考にした。同じレベルの問題で一番簡単な解法で用いられている手筋が違う複数の問題を比較して各手筋の難易度点数を決定した。例えば、最も簡単な解法がある手筋Aを1回だけ使う問題と、ある手筋Bを2回使う問題が同じレベルの難易度に属しているとする。この時、手筋Aは手筋Bのおおよそ2倍の点数となるように設定するといった仕方である。また、同じ名称で呼ばれている手筋でも、手筋が成立している場所や、マスの数で異なるようにした。

\subsection{問題の難易度点数の計算手法}
本研究では分枝限定法と動的計画法を組み合せた手法により問題の難易度点数の計算を効率的に行う．
まずは分枝限定法による解法探索について説明する．\saitohcom{パズルでも「局面」という言葉は使うのか？（ゲームでの言葉？）盤面で統一した方がいいのでは？}数独における盤面が与えられたとする．
% 各局面は解答された状態である最終局面以外は数独の解答途中の盤面で，手筋を使用する前の盤面である．
その局面で使える手筋を列挙し，それを適用した盤面をそれぞれの手筋ごとで作成し，作成された盤面に対して再帰的に深さ優先で探索を行う．%適用された盤面が適用する前の盤面を親とした新しい局面となる．
これを途中で枝刈りをされるか，すべての数字が埋められるまで続ける．また，各局面にはその局面から再帰的に探索した中で%その局面から数字をすべて埋める状態までで
難易度点数が最も低い解法の難易度点数を記録する．%この記録された点数は探索中に現在の値より難易度点数が小さくなるような解法を発見したらその点数に更新されるようになっている．

各盤面 $B$ には初期盤面からその盤面に到達するまでに使用した手筋の点数の総和 $x$ を記録する．また，盤面 $B$ に到達するまでの探索の途中で得られた解法における暫定的な最小の難易度点数 $x^*$ を保持しておく．ここで $x$ が $x^*$ を超える場合，その盤面 $B$ からの探索で得られるどの解法も難易度点数が $x^*$ 未満となることはない．つまり，盤面 $B$ を探索することで，よりよい解法を見つけることはできないため，盤面 $B$ を枝刈りすることができる．
% また，手筋の使用する前の盤面から手筋を使用した後の盤面を生成する時に，使用する前の局面が持っている現時点で最も簡単な解法の難易度点数から，使用した手筋の難易度点数を引いた数をその局面の最も簡単な解法の初期値として持っておく．これにより，生成された局面の初期値が0以下になった場合，最も簡単な解法が他にあるという事になる．そこからどのような解法を選んでも最も簡単な解法ではなくなるので，そこから先は探索しないことで枝刈りができる．このようにして探索を行い，最終的に一番上の局面，つまり初期盤面の局面に記録された難易度点数が，最も簡単な解法の難易度点数になる．

具体例を\figref{sudoku_search}に示す。ここでは局面Aから点数3である手筋を用いて局面Bに行き、さらに点数4である手筋を用いて数字が全て埋まった完成盤面Cに行ったところである。局面Aから完成局面Cまで行く解法の難易度点数は\{3+4=7\}となる。よって、局面Aでの暫定の最小点数は7となる。ここから、局面Aで使える、局面Bに行く時に使った手筋とは違う点数4の手筋を使って局面Dに行く。ここで、局面Dの暫定の最小点数は\{7-4=3\}となる。なぜなら、3よりも大きい点数を持つ手筋を局面Dで使うとする。局面Aから見た、その手筋を用いた解法の点数は4に3よりも大きい数を足す事が確定しているので7よりも大きい数となる。しかし、局面Aから見た解法で現在最も点数が小さい解法のその点数は7である。したがって、その解法は局面Aから見て最小の難易度点数を取らない。よって、局面Dでの暫定の最小点数は3とすることで、3以上の手筋を局面Dで適用させないようにしている。\figref{sudoku_search}では、局面Dから点数4の手筋を用いて局面Eに行くことができるが、点数が3よりも大きいので枝刈りされている。

	\begin{figure}[tb]
 	\includegraphics[keepaspectratio, scale=0.45]
      		{sudoku_search.png}
 	\caption{探索の例}
	\ecaption{Example of search}
 	\label{sudoku_search}
	\end{figure}

	\subsection{手筋の列挙}
各局面でその盤面で使用できる全ての手筋の場所や関連する数字を求める必要がある．そのような場合、盤面内で使える手筋を探し、見つけたら後で数字をマスに入れたり候補数字を消したりするために、発見した全ての手筋について場所と数字を記録する。\saitohcom{この手続きの意味がわからないです．手筋を適用しての話？この後ろの文もどういう状況かがわかりませんでした．}なお、手筋を発見しても盤面内のどのマスでも候補数字が変化しない場合がある。その場合は盤面内に変化がないならその手筋を使う事に意味が無いため、その発見した手筋は使わない事とし、手筋の実行に必要な情報の記録はされない。

	\subsection{高速化}
上記の単純な分枝限定法では，ある盤面で用いる事のできる手筋が多い場合に探索に時間がかかる．特に上級と判定される問題にそのような盤面が多く出てくる傾向がある．そのため，効率的に問題を解くためにハッシュを用いて，過去の盤面の計算結果を蓄えることでアルゴリズムの高速化を行う．
% 上級と判定された問題について、ある盤面で用いる事のできる手筋が比較的多い場合にそうでない場合と比べて探索に時間がかかったため、高速化を行った。
これは探索中に出現するある局面において，その盤面を解くための最小の難易度点数は，初期状態からその局面に至るまでに使われた手筋に依存しない．% の種類がどうであれ,一意に決定している．これが成り立つ事を説明する．
% 候補数字を含めた盤面の状態は全く同じであるが,片方は初期状態から手筋Aを用いて導かれ,もう一方は手筋Aを用いずに導かれた2つの盤面があるとする．ここで,全く同じ手筋を2回以上用いても,1回目の使用でその手筋が消す候補数字が全て消えているため盤面は変化しない．これより,手筋Aを用いて導かれた盤面について,もう一度手筋Aを使用しても盤面は変化しない．手筋Aを用いずに導かれた盤面は手筋Aを用いて導かれた盤面と候補数字まで同じであるから,手筋Aを使用しても盤面は変化しない．これより,手筋Aを用いた用いていないに関わらず,同じ盤面に対してそこから使用できる手筋の種類は同じである事が分かる．よって,初期状態からその盤面に至るまでに使われた手筋の種類がどうであれ,その盤面に対して使用できる手筋の種類は同じであるため,その盤面を解く最小点数も一意に決定している．
そのため，探索中に出現した盤面が，もうすでに最小点数が計算された盤面である時に，その盤面に対する最小点数をもう一度計算することは無駄である．よって，盤面に対する最小の解法の点数が計算されたら，その盤面と最小点数の組み合わせをハッシュに保存する．ある盤面に対して枝刈りされた場合，その盤面と枝刈りされた時点での暫定の最小点数の組み合わせとともに，そのときの暫定的な最小点数\saitohcom{ここでの暫定の最小点数は何を指す？この盤面を根とした探索での，その中のみでの値か？この盤面を訪問した際での暫定の最小点数か？}をハッシュに格納する．これにより，探索中でのある盤面に対し，その盤面をハッシュで検索する事ですでに探索済みかどうかを確認することができる．もし探索済みの場合，盤面と一緒に格納されている点数と，新たな局面の最小点数の初期値の大小を比べる。\saitohcom{ここでの新たな局面と最小点数の初期値がそれぞれ何を指すかがわからなくなりました．初期値とは盤面に訪問するときの初期盤面からの点数？この後も修正しきれず．．．}もし盤面と一緒に格納されている点数が新たな局面の最小点数の初期値以上であった場合、盤面と一緒に格納されている点数はそれを解くために必要な最低限の点数であることを表すので、この先の探索で必ず現在の最小点数を超えることになる。よって、打ち切りを行う。そうでない場合、つまり盤面と一緒に格納されている点数が新たな局面の最小点数の初期値よりも小さい場合は最小点数を更新する解法がある可能性があるので、そのまま探索を行う。
こうすることで探索中に出現した盤面を高速に検索することができるため，最小の解法の点数を計算済みの盤面であった場合に，再帰的に再計算することなく，その点数をハッシュから取り出すことで高速で求めることができる．
% 具体的には、探索中の盤面の最小点数が決定した時、もしくは探索が打ち切られた時にその盤面と点数を格納する。探索中の盤面の最小点数が決定した時は、その盤面とそれを解くための解法の最小点数の組み合わせをハッシュに格納する。この2つの場合のいずれにせよハッシュに格納された盤面に対してそれを解くための解法の最小点数は、一緒に格納された点数以上となる。
% この打ち切りにより、同じ盤面に対して何度も同じ計算をしなくてよいので、高速化を行う事ができる。



%4
\section{計算機実験}
本研究で3節のアルゴリズムをc++で実装した．計算機のプロセッサはIntel(R) Core(TM) i7-8550U CPU @ 1．80GHz   2．00 GHzを使用した．

株式会社ニコリ社から発行されている「てごろな数独1」の，難易度Mediumの問題から問題番号が4の倍数である18問を抜粋し，その問題に対して作成したプログラムを実行した\cite{てごろな数独1}．その結果，どの問題も一意の解を求める事ができた．この時，各問題に対して出力された難易度点数の結果を\tabref{this_study_medium}に示す．なお，実行時間は3回実行した時の平均である．また，公式難易度とは「てごろな数独1」など株式会社ニコリの一部の数独の単行本で各問に対して設定されている，1，2，3，4，5，6，7，8，8+，9，9+，10，10+の13段階で設定されている難易度を示す値である．以下に登場する数独の単行本の問題は全てこの13段階の難易度が設定されている．

　	\begin{table}[tb]
		\caption{先行研究の中級問題に対する難易度点数}
		\label{this_study_medium}
		\centering
			\begin{tabular}{crcr}
			\hline
			問題 & 点数[点] & 公式難易度 & 実行時間[s]\\
			\hline
問題16 & 1 & 4 & 0.0175\\
問題20 & 1 & 4 & 0.0203\\
問題24 & 1 & 4 & 0.0201\\
問題28 & 1 & 4 & 0.0228\\
問題32 & 1 & 4 & 0.0244\\
問題36 & 1 & 4 & 0.0203\\
問題40 & 3 & 5 & 0.0224\\
問題44 & 2 & 5 & 0.0355\\
問題48 & 3 & 5 & 0.0425\\
問題52 & 3 & 5 & 0.0406\\
問題56 & 3 & 5 & 0.0397\\
問題60 & 6 & 5 & 0.0423\\
問題64 & 3 & 6 & 0.0413\\
問題68 & 4 & 6 & 0.0412\\
問題72 & 6 & 6 & 0.0404\\
問題76 & 6 & 6 & 0.0446\\
問題80 & 10 & 6 & 0.0399\\
問題84 & 18 & 6 & 0.0407\\
			\hline
	 	\end{tabular}
	\end{table}

公式難易度と難易度点数で相関を取った結果，相関係数は0．68となった．
また，株式会社ニコリ社から発行されている「難関数独11」の問題から問題番号が4の倍数である26問を入力として抜粋した\cite{難関数独11}．それらの問題に対して作成したプログラムを実行した．その結果，どの問題も一意の解を求める事ができた．この時，各問題に対して出力された難易度点数と実行時間の結果を\tabref{this_study_hard}に示す．なお，実行時間は3回実行した時の平均である．

　	\begin{table}[tb]
		\caption{先行研究の上級問題に対する難易度点数}
		\label{this_study_hard}
		\centering
			\begin{tabular}{crcr}
			\hline
			問題 & 点数[点] & 公式難易度 & 実行時間[s]\\
			\hline
問題4 & 7 & 7 & 0.0336\\
問題8 & 7 & 7 & 0.0293\\
問題12 & 14 & 7 & 0.0367\\
問題16 & 7 & 7 & 0.0331\\
問題20 & 17 & 7 & 0.0529\\
問題24 & 20 & 8 & 0.0329\\
問題28 & 21 & 8 & 0.0474\\
問題32 & 7 & 8 & 0.0284\\
問題36 & 10 & 8 & 0.0606\\
問題40 & 28 & 8 & 0.0420\\
問題44 & 30 & 8+ & 0.0354\\
問題48 & 30 & 8+ & 0.0506\\
問題52 & 40 & 8+ & 0.0413\\
問題56 & 30 & 8+ & 0.0331\\
問題60 & 60 & 8+ & 0.0899\\
問題64 & 40 & 9 & 0.0846\\
問題68 & 44 & 9 & 0.0364\\
問題72 & 54 & 9 & 0.0828\\
問題76 & 65 & 9 & 0.1197\\
問題80 & 31 & 9 & 0.3216\\
問題84 & 80 & 9+ & 0.0534\\
問題88 & 80 & 9+ & 0.0459\\
問題92 & 71 & 9+ & 0.1571\\
問題96 & 90 & 10 & 0.0604\\
問題100 & 90 & 10 & 0.0487\\
問題104 & 320 & 10+ & 0.0487\\
			\hline
	 	\end{tabular}
	\end{table}
公式難易度と難易度点数で相関を取った結果，相関係数は0.90となった．

また，数独の難易度を測る研究として，手筋を探索する回数をもとに難易度の点数を決定する研究が行われている\cite{2011sudo58:online}．本研究との比較のために，その先行研究に基づいて難易度点数を求めるプログラムを作成した．比較対象は「てごろな数独1」「難関数独11」の本研究で入力した問題とした\cite{てごろな数独1}\cite{難関数独11}．なお先行研究で実装されていないために探索できない手筋を使う必要があるため，「難関数独11」の問題のうち104番のみ結果を取っていない．

本研究で入力した「てごろな数独1」の問題に対する，先行結果の難易度点数と実行時間の結果を\tabref{previous_study_medium}に示す．なお，実行時間は3回実行した時の平均である．

　	\begin{table}[tb]
		\caption{本研究の中級問題に対する難易度点数}
		\label{previous_study_medium}
		\centering
			\begin{tabular}{crrcrr}
			\hline
			問題 & 難易度点数[点] & 公式難易度 & 実行時間[s]\\
			\hline
問題16 & 41 & 4 & 0.0310\\
問題20 & 45 & 4 & 0.0448\\
問題24 & 74 & 4 & 0.0778\\
問題28 & 72 & 4 & 0.0570\\
問題32 & 65 & 4 & 0.0511\\
問題36 & 68 & 4 & 0.0307\\
問題40 & 66 & 5 & 0.0688\\
問題44 & 65 & 5 & 0.0230\\
問題48 & 75 & 5 & 0.0639\\
問題52 & 69 & 5 & 0.0558\\
問題56 & 71 & 5 & 0.0519\\
問題60 & 70 & 5 & 0.0314\\
問題64 & 61 & 6 & 0.0380\\
問題68 & 66 & 6 & 0.0856\\
問題72 & 70 & 6 & 0.0254\\
問題76 & 62 & 6 & 0.0729\\
問題80 & 75 & 6 & 0.0735\\
問題84 & 67 & 6 & 0.0776\\
			\hline
	 	\end{tabular}
	\end{table}

公式難易度と難易度点数で相関を取った結果，相関係数は0.27と本研究より低い値となった．

また，本研究で入力した　「難関数独11」の104番以外の問題に対する，先行結果の難易度点数と実行時間の結果を\tabref{previous_study_medium}に示す．なお，実行時間は3回実行した時の平均である．

　	\begin{table}[tb]
		\caption{先行研究の上級問題に対する難易度点数}
		\label{previous_study_hard}
		\centering
			\begin{tabular}{crrcrr}
			\hline
			問題 & 難易度点数[点] & 公式難易度 & 実行時間[s]\\
			\hline
問題4 & 185 & 7 & 0.0406\\
問題8 & 125 & 7 & 0.0186\\
問題12 & 584 & 7 & 0.0189\\
問題16 & 218 & 7 & 0.0174\\
問題20 & 255 & 7 & 0.0188\\
問題24 & 220 & 8 & 0.0178\\
問題28 & 719 & 8 & 0.0186\\
問題32 & 156 & 8 & 0.0178\\
問題36 & 173 & 8 & 0.0176\\
問題40 & 739 & 8 & 0.0185\\
問題44 & 196 & 8+ & 0.0171\\
問題48 & 156 & 8+ & 0.0171\\
問題52 & 501 & 8+ & 0.0184\\
問題56 & 190 & 8+ & 0.0166\\
問題60 & 522 & 8+ & 0.0183\\
問題64 & 169 & 9 & 0.0180\\
問題68 & 615 & 9 & 0.0189\\
問題72 & 742 & 9 & 0.0179\\
問題76 & 1200 & 9 & 0.0194\\
問題80 & 224 & 9 & 0.0175\\
問題84 & 212 & 9+ & 0.0180\\
問題88 & 502 & 9+ & 0.0176\\
問題92 & 950 & 9+ & 0.0191\\
問題96 & 2032 & 10 & 0.0208\\
問題100 & 2321 & 10 & 0.0208\\
			\hline
	 	\end{tabular}
	\end{table}

公式難易度と難易度点数で相関を取った結果，相関係数は0.58と本研究より低い値になった．

\section{考察}

\subsection{中級問題について}

ここで，本研究の結果についてマスミの点数を変えると相関係数がどのように変化するのか調査を行った．その結果を\tabref{table:masumi}に示す．

%値を変える
　	\begin{table}[tb]
		\caption{マスミの点数による相関係数の変化}
		\label{table:masumi}
		\centering
			\begin{tabular}{cr}
			\hline
			マスミの点数 & 相関係数\\
			\hline
	3 & 0.80 \\
	4 & 0.77 \\
	5 & 0.73 \\
	6 & 0.70 \\
	7 & 0.68 \\
	8 & 0.65 \\
	9 & 0.63 \\
	10 & 0.62 \\
	11 & 0.60 \\
			\hline
	 	\end{tabular}
	\end{table}


これより，マスミの点数が小さくなるほど，相関係数が1に近づいている事が分かる．しかし，実際にマスミの点数を下げる場合，例えば3まで下げると，レッツミーのみを3回使う，中級問題の中では比較的易しい問題と難しい問題の丁度間にある難易度のような問題と，マスミのみを1回使う中級問題の中では比較的難しい問題が，同じ難易度点数になってしまう．これを避けるには，使用したレッツミーの回数が少ないほど，マスミの点数を上げるといった対策が考えられる．これにより，レッツミーの使用回数が少ないマスミを使う中級問題の点数は比較的高いままで，複数回のレッツミーとマスミを使う問題の難易度点数を下げられ，相関係数が高くなると考えられる．

また，同じ種類の手筋で，かつ注目する領域が同じで注目する数字の種類もしくはマスの数が同じであっても，数字の配置や手筋が成立する場所によって，その手筋の発見のしやすさが変わってくることがある．例えば\figref{sample_rettumi_easy}では，一番上の一番右のマスに1が入ることをレッツミーで見つけるには，2つの1を見る必要がある．一方，\figref{sample_rettumi_difficult}では，一番上の一番右のマスに1が入ることをレッツミーで見つけるには，4つの1を見る必要がある．この2つのうち後者の方が一般的に見つけるのが難しいと考えられる．このような手筋の見えにくさを数値化して，同じ手筋でも見えにくさによって違う点数を取るようにすれば，より精度が高い難易度点数判定ソルバーが作成できるかもしれない．

	\begin{figure}[tb]
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.2]
      		{sample_rettumi_easy.png}
 	\caption{レッツミーの簡単な例}
 	\label{sample_rettumi_easy}
	\end{minipage}%
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.2]
      		{sample_rettumi_difficult.png}
 	\caption{レッツミーの難しい例}
 	\label{sample_rettumi_difficult}
	\end{minipage}
	\end{figure}

先行研究の結果では問題24から84の問題がおおよそ70前後という結果になった．この先行研究では，1つの数字に着目し，初級の手筋で入るブロックを探すといったことを1から9まで繰り返し行っていて，1つの数字に対する探索につき1加算する方法を取っている．それで埋まらなければ，残っている空白マスの数を難易度点数に加算して中級の手筋で解く，といった難易度付けをしている．中級手筋を使うまでに埋まった数字を調べるとおおよそが15個前後で，その時点での残りマスが50個前後であったため，先行研究の点数の付け方を踏まえるとこの結果は妥当であろう．また，問題16，20の結果が41，45と他と違う値になった理由を調べたところ，加算した残りの空白マスの数が他の問題より少ない，つまり比較的盤面に数字が埋まったところで中級の手筋を使い出したからであった．

\subsection{上級問題について}
問題32と36に着目する．難易度点数の結果はそれぞれ7，10となっており，他の難易度8と比べると低い．問題32の解法についてさらに考察を行うと，問題を解く過程で中級手筋の中でも難しい手筋であるマスミを使っていることが分かった．．これより，使っている上級手筋の種類や回数は少なくとも，途中で難しい中級手筋を使えば上級手筋の種類や回数が同等の問題よりも難しくランク付けされている可能性がある．今回は難易度が格段に違うと行った理由から，上級問題での解法分析では中級以下の手筋に難易度点数がないものとして点数を計算している．しかし，上級手筋だけでなく中級手筋がどのように使われたかも加味すればより精度の高い難易度決定ができるかもしれない．
%（他の難易度8の問題も示す？）

また，先行研究の結果では同じ難易度でも比較的点数が低い問題と高い問題に分かれている．これらの違いを調べてみると，例えば，難易度7の問題である問題4から20のうち，12番だけが他よりも高い値となっている．これは，12番以外の難易度7の問題は先に探索される2マスの表予約と裏予約のみ使って解ける問題であるのに対し，12番の問題はその後に探索されるいずれにしても理論を使わなければ解けない問題となっているからである．つまり，12番以外の問題は1種類の上級手筋の探索で終わるが，12番は2種類の上級手筋の探索をしなければならないので難易度点数が高くなっている．このように，同じ難易度でも使う手筋によって盤面を探索する回数に変化がある．先行研究によると1つの手筋に対する1回の探索で少なくとも54難易度点数が上がるので，これにより難易度点数にばらつきが現れると考えられる．
%いずれにしても理論を使用する問題は点数が500点以上になっている事が分かる．

また，先行研究では公式難易度7と8+で，難易度点数の差が変わらない問題がある．これは，難易度7の問題ではブロック内の2マスの表予約を使う問題があり，公式難易度8+の問題では列内の2マスの表予約を使う問題がある．本の難易度設定ではブロックよりも列にある予約の方が難しいとされているので後者の方が難しいとされている．しかし，先行研究ではブロックの2マス表予約と列の2マス予約を同じ難易度と見なし1回の探索で同時に探索を行っているので，難易度点数の差が変わっていないと考えられる．
%タスク:同じ問題(群)に対して3つの実験の結果を比較し，それぞれの手法がどのような問題を得意･不得意としているのかを調べる->難易度ごとに問題を分けて，公式難易度との相関係数を3つの研究結果それぞれごとに取り，どれが特に良かったかを調べ，その理由について考察する．

また，上級手筋でも手筋の見えにくさというものがある．例えば，次のようなブロックでの3マスにおける表予約の成立時に顕著に出る．例えば\figref{sample_yoyaku_block3_easy}と\figref{sample_yoyaku_block3_difficult}はどちらもブロック内の3マスの表予約が成立している場合である．ここで，\figref{sample_yoyaku_block3_easy}では表予約を成立させている数字が上から1行目と左から1列目に固まっているので，この2つの列に注目すれば表予約が存在することに気づきやすい．しかし，\figref{sample_yoyaku_block3_difficult}では注目するべき列が上から1行目と2行目，左から1行目と2行目と先ほどの例よりも多い．さらに表予約が成立しているブロックに対して2行が効いている数字（ここでは1），2列が効いている数字（ここでは2），1行と1列が効いている数字（ここでは3）がある．どの数字もブロックに対しての数字の効き方が異なるので，この3つの数字が表予約を成立させていることに気づくのは前述の2列しか見なくてよい表予約よりも一般的に難しいとされている．

よって，先述したブロックでの3マスにおける表予約のように，手筋が成立しているマスの位置や，手筋成立に関わっている数字がある行や列を調べて，手筋に付ける難易度点数を変えるといった改善も考えられる．

	\begin{figure}[tb]
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.2]
      		{sample_yoyaku_block3_easy.png}
 	\caption{ブロック3マス表予約の簡単な例}
 	\label{sample_yoyaku_block3_easy}
	\end{minipage}%
	\begin{minipage}[t]{0.5\columnwidth}
 	\includegraphics[keepaspectratio, scale=0.2]
      		{sample_yoyaku_block3_difficult.png}
 	\caption{ブロック3マス表予約の難しい例}
 	\label{sample_yoyaku_block3_difficult}
	\end{minipage}
	\end{figure}

\section{おわりに}
今回の入力問題では，相関係数の結果や考察から先行研究よりも本研究の方が公式の難易度に近い難易度の目安を出せることが分かった．しかし，本研究では入力問題が掲載されている本を出版している会社が，どの手筋をどのような難易度で扱っているかを参考にして製作した．よって，他の出版社の本では今回とはまた違った結果になると考えられる．例えば，先行研究のように探索の回数の方を重点的に見るような指標で公式難易度が付けられている本であれば，先行研究の方が適切であろう．しかし，本研究の難易度設定とは違えど，それぞれの手筋に対して初級手筋，中級手筋など大まかな難易度付けが行われており，それに基づいて公式難易度が設定されているならば，本研究の手法が有効である可能性は高い．なぜなら，その難易度設定を元に各手筋の点数を決め，本研究の手法のように解法に点数を付けることで，それを難易度の目安とできるからである．また，先行研究は決して本研究より悪い点ばかりではない．数字を探索する時の手間という，人間が解く時に難しいと感じる部分を点数で表している研究である．今回作成した最も簡単な解法を見つける手法と，先行研究の探索の手間暇を数値化する手法，これらの良いバランスを取っている手法が今後出てくれば，数独の難易度決定はより安定し，より多くの人が納得できる難易度を付けやすくなるだろう．

%\renewcommand{\bibname}{参考文献}

\bibliographystyle{junsrt}
\bibliography{bibsample}




\end{document}
